(function(e){function t(t){for(var n,r,l=t[0],o=t[1],u=t[2],p=0,d=[];p<l.length;p++)r=l[p],i[r]&&d.push(i[r][0]),i[r]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);c&&c(t);while(d.length)d.shift()();return s.push.apply(s,u||[]),a()}function a(){for(var e,t=0;t<s.length;t++){for(var a=s[t],n=!0,l=1;l<a.length;l++){var o=a[l];0!==i[o]&&(n=!1)}n&&(s.splice(t--,1),e=r(r.s=a[0]))}return e}var n={},i={app:0},s=[];function r(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=n,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],o=l.push.bind(l);l.push=t,l=l.slice();for(var u=0;u<l.length;u++)t(l[u]);var c=o;s.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"2d55":function(e,t,a){"use strict";var n=a("396e"),i=a.n(n);i.a},"396e":function(e,t,a){},"41ea":function(e,t,a){"use strict";var n=a("cabc"),i=a.n(n);i.a},"56d7":function(e,t,a){"use strict";a.r(t);a("cadf"),a("551c"),a("f751"),a("097d");var n=a("2b0e"),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},s=[],r=(a("7c55"),a("2877")),l={},o=Object(r["a"])(l,i,s,!1,null,null,null),u=o.exports,c=a("8c4f"),p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home"},[a("belle-template-message",{ref:"belleTemplateMessage",attrs:{configParams:e.configParams},on:{onSendSMS:e.handleSendSMS}}),a("el-button",{on:{click:e.handleGetData}},[e._v("获取数据")]),a("el-button",{on:{click:e.handleSetData}},[e._v("回显数据")]),a("el-button",{on:{click:e.handleValidate}},[e._v("获取校验")])],1)},d=[],m={name:"home",components:{},data:function(){return{configParams:{brandCode:"BL",sceneId:"272702802c034b4f90d70db40e41bb87"}}},methods:{handleGetData:function(){var e=this.$refs["belleTemplateMessage"].getData();console.log("data",e)},handleSetData:function(){var e={wechatTemplateId:"0Nj31bGBN-ZR-HAE5M6_A6xzrDV5e5K5kZ0TSBoghOU",miniProgramAppId:"111",miniProgramPagePath:"222",url:"333",linkType:"weapp",phoneList:["13011112222","13022223333"],templateEditBeanList:[{templateId:"0Nj31bGBN-ZR-HAE5M6_A6xzrDV5e5K5kZ0TSBoghOU",labelName:"消费",labelParamKey:"accountType",labelParamValue:"111",labelParamColor:null,valueParamKey:"account",valueParamValue:"222222{姓名}sgs{品牌}gsdg"}]};this.$refs["belleTemplateMessage"].setData(e),console.log("data",e)},handleValidate:function(){var e=this.$refs["belleTemplateMessage"].validateForm();console.log("data",e)},handleSendSMS:function(e,t){console.log("handleSendSMS",e,t)}}},h=m,f=Object(r["a"])(h,p,d,!1,null,null,null),v=f.exports;n["default"].use(c["a"]);var b=new c["a"]({routes:[{path:"/",name:"home",component:v}]}),g=a("2f62");n["default"].use(g["a"]);var w=new g["a"].Store({state:{},mutations:{},actions:{}}),y=a("5c96"),L=a.n(y),_=a("bc3a"),T=a.n(_),k=T.a.create({baseURL:"http://10.0.30.96/mock/142",timeout:5e3});k.interceptors.request.use(function(e){return e},function(e){console.log(e),Promise.reject(e)}),k.interceptors.response.use(function(e){return e.data},function(e){return console.log("err"+e),Object(y["Message"])({message:e.message,type:"error",duration:5e3}),Promise.reject(e)});var P=k,C=(a("0fae"),a("7f7f"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"template-message"},[a("section",[a("div",{staticClass:"term"},[e._m(0),a("el-select",{staticClass:"input",attrs:{filterable:"",placeholder:"请选择"},on:{change:e.handleChangeTemplate},model:{value:e.templateId,callback:function(t){e.templateId=t},expression:"templateId"}},e._l(e.templateOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),a("div",{staticClass:"term"},[a("p",[e._v("插入参数：")]),a("div",{staticClass:"params-list"},e._l(e.smsParams,function(t){return a("AddParamBtn",{key:t,attrs:{btnName:t,onadd:e.onaddData}})}),1)]),a("div",{staticClass:"term top"},[e._m(1),a("div",{staticClass:"new-member-notice"},[a("div",{staticClass:"title"},[e._v("模板ID："+e._s(e.currentTemplate?e.currentTemplate.id:""))]),a("div",{staticClass:"title mb-l"},[e._v("别名："+e._s(e.currentTemplate?e.currentTemplate.templateContent:""))]),e._l(e.templateEditBeanList,function(t,n){return a("section",{key:t.templateId},[t.labelName?a("div",[e._v(e._s(t.labelName))]):e._e(),t.labelParamKey?a("div",[e._v(e._s(t.labelParamKey))]):e._e(),t.labelParamKey?a("div",{staticClass:"name"},[a("el-input",{ref:t.labelParamKey,refInFor:!0,staticStyle:{width:"80%"},attrs:{maxlength:"100"},model:{value:e.templateEditBeanList[n].labelParamValue,callback:function(t){e.$set(e.templateEditBeanList[n],"labelParamValue",t)},expression:"templateEditBeanList[templateEditorIndex].labelParamValue"}})],1):e._e(),a("div",[e._v(e._s(t.valueParamKey))]),a("div",{staticClass:"wrap"},[a("Editable",{ref:t.valueParamKey,refInFor:!0,attrs:{value:t.valueParamValue,onChange:function(t){return e.handleEditorChange(n,t)},maxNum:160}})],1)])})],2)]),a("div",{staticClass:"term"},[a("p",[e._v("模板详情链接：")]),a("el-select",{staticClass:"input",attrs:{placeholder:"请选择"},model:{value:e.linkType,callback:function(t){e.linkType=t},expression:"linkType"}},e._l(e.linkTypes,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:"weapp"===e.linkType,expression:"linkType === 'weapp'"}],staticClass:"term"},[e._m(2),a("el-input",{staticClass:"input",attrs:{type:"text"},model:{value:e.weappId,callback:function(t){e.weappId=t},expression:"weappId"}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:"weapp"===e.linkType,expression:"linkType === 'weapp'"}],staticClass:"term"},[e._m(3),a("el-input",{staticClass:"input",attrs:{type:"text"},model:{value:e.weappPath,callback:function(t){e.weappPath=t},expression:"weappPath"}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:"weapp"===e.linkType,expression:"linkType === 'weapp'"}],staticClass:"term"},[e._m(4),a("el-input",{staticClass:"input",attrs:{type:"text"},model:{value:e.weappLink,callback:function(t){e.weappLink=t},expression:"weappLink"}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:["material","lottery","enroll","wePage","limitedSales"].includes(e.linkType),expression:"['material', 'lottery', 'enroll', 'wePage', 'limitedSales'].includes(linkType)"}],staticClass:"term indent"},[a("el-button",{attrs:{rel:e.linkType}},[e._v("选择"+e._s(e.getName()))])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:"customLink"===e.linkType,expression:"linkType === 'customLink'"}],staticClass:"term"},[e._m(5),a("el-input",{staticClass:"input",attrs:{type:"text",placeholder:"请输入链接"},model:{value:e.customLink,callback:function(t){e.customLink=t},expression:"customLink"}})],1),a("div",{staticClass:"term"},[a("p",[e._v("测试发送：")]),a("el-select",{staticClass:"phone-select",attrs:{multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"请输入测试手机号，多个手机号请按回车键进行分隔","popper-class":"phone-dropdown"},model:{value:e.phoneList,callback:function(t){e.phoneList=t},expression:"phoneList"}},e._l(e.phoneOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),a("el-button",{staticClass:"ml",attrs:{type:"primary"},on:{click:e.handleSendSMS}},[e._v("发送")])],1),a("div",{class:(e.phoneError?"text-red":"text-grey")+" indent phone-tip"},[e._v(e._s(e.phoneTip))])])])}),x=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",[a("span",[e._v("*")]),e._v("选择模版：")])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",[a("span",[e._v("*")]),e._v("模版内容：")])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",[a("span",[e._v("*")]),e._v("小程序APPID：")])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",[a("span",[e._v("*")]),e._v("小程序路径：")])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",[a("span",[e._v("*")]),e._v("备用网页链接：")])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",[a("span",[e._v("*")]),e._v("自定义链接：")])}],E=a("7618"),I=a("cebc"),S=(a("20d6"),a("456d"),a("ac6a"),a("7514"),a("96cf"),a("3b8d")),N=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:e.domref,staticClass:"editable",attrs:{contenteditable:"true"},on:{focus:function(t){return e.onfouc(t)},blur:function(t){return e.onblur(t)},input:function(t){return e.computeMaxNum()}}},[e._v(e._s(e.value))])},O=[],$=(a("a481"),a("c5f6"),{name:"Editable",props:{placeholder:{type:String,default:""},value:{type:String,default:""},domref:{type:String,default:""},maxNum:{type:Number,default:0},contentLength:{type:Number,default:0},onChange:{type:Function,default:function(){return function(){}}}},data:function(){return{}},created:function(){},mounted:function(){var e=this;this.$refs[this.domref].addEventListener("DOMSubtreeModified",function(){e.computeMaxNum()},!1)},methods:{bindEvents:function(){var e=this;document.addEventListener("selectionchange",function(t){var a=t.target.activeElement;if("editable"===a.className){var n,i="";if(window.getSelection){var s=window.getSelection();n=s.anchorOffset;var r=s.focusOffset,l=s.anchorNode.parentElement,o=s.focusNode.parentElement,u=l.innerText;l===o&&(i=u.substring(n,r))}else(t.selectionStart||"0"===t.selectionStart)&&(n=t.selectionStart);return console.log("txt",i),e.cursorIndex=n,a.cursorIndex=n,n}})},onfouc:function(){},onblur:function(){var e=this.$refs[this.domref].innerHTML;""===e&&(this.$refs[this.domref].innerHTML=this.placeholder)},computeMaxNum:function(){var e=this.$refs[this.domref].childNodes,t="";e.forEach(function(e){if(e.tagName)t+=e.value;else{var a=e.textContent;a=a.replace(/({)/g,"").replace(/(})/g,""),t+=a}}),this.$refs[this.domref].data=t,this.onChange(t)}}}),B=$,j=(a("f5a8"),Object(r["a"])(B,N,O,!1,null,"2a34c282",null)),M=j.exports,D=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"addparamBtn",on:{mousedown:function(t){return e.onmousedown(t)},click:function(t){return e.onclick(e.btnName)}}},[e._v("\n  "+e._s(e.btnName)+"\n")])},K=[],V={name:"AddParamBtn",props:{btnName:{type:String,default:""},onadd:{type:Function,default:function(){return function(){}}}},methods:{onmousedown:function(e){return e&&e.preventDefault?e.preventDefault():window.event.returnValue=!1,!1},onclick:function(){var e=window.getSelection();e.baseNode&&e.baseNode.parentNode&&("editable"===e.baseNode.className||"editable"===e.baseNode.parentNode.className)&&this.onadd(this.btnName)}}},A=V,R=(a("2d55"),Object(r["a"])(A,D,K,!1,null,null,null)),F=R.exports;function q(e){var t,a;if(window.getSelection){if(t=window.getSelection(),t.getRangeAt&&t.rangeCount){a=t.getRangeAt(0),a.deleteContents();var n=document.createElement("div");n.innerHTML=e;var i,s,r=document.createDocumentFragment();while(i=n.firstChild)s=r.appendChild(i);a.insertNode(r),s&&(a=a.cloneRange(),a.setStartAfter(s),a.collapse(!0),t.removeAllRanges(),t.addRange(a))}}else document.selection&&"Control"!==document.selection.type&&document.selection.createRange().pasteHTML(e)}var H={name:"belle-template-message",components:{Editable:M,AddParamBtn:F},props:{configParams:{type:Object,default:function(){return{}}}},data:function(){return{brandCode:"BL",sceneId:"",allParams:[],smsParams:[],paramList:[],allTemplates:[],templateId:"",templateOptions:[{value:"v1",label:"预约成功提醒"},{value:"v2",label:"发售提醒-（购买、排队、定金、抽签资格码-纯线上）"},{value:"v3",label:"抽签结果公布 （中签通知）-抽签资格码纯线上类型"}],currentTemplate:{},templateEditBeanList:[],linkType:"",linkTypes:[{value:"customLink",label:"自定义链接"},{value:"weapp",label:"小程序"}],menu:"",menus:[{value:"m1",label:"限量发售"},{value:"m2",label:"活动中心"},{value:"m3",label:"个人账号"},{value:"m4",label:"我的优惠券"},{value:"m5",label:"权益中心"}],templateContentList:{},customLink:"",weappId:"",weappPath:"",weappLink:"",phoneList:[],phoneOptions:[],phoneError:!1,phoneTip:"多个手机号请按 回车键 进行分隔",wechatOpenIdList:[]}},created:function(){var e=this.configParams,t=e.brandCode,a=e.sceneId;this.brandCode=t,this.sceneId=a,this.fetchParamsList(),this.fetchTemplateList()},methods:{fetchParamsList:function(){var e=Object(S["a"])(regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$request({url:"/component/system/scenes",params:{sceneId:this.sceneId}});case 2:t=e.sent,a=t.data,this.allParams=a&&a.list?a.list:[],this.smsParams=this.allParams.map(function(e){return e.paramKey});case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),fetchTemplateList:function(){var e=Object(S["a"])(regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$request({url:"/component/system/getBrandCodeWechatNativeTemplate",params:{brandCode:this.brandCode,sceneId:this.sceneId}});case 2:t=e.sent,a=t.data,a&&a.list&&(this.allTemplates=a.list,this.templateOptions=a.list.map(function(e){return{label:e.templateName,value:e.id}}));case 5:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getName:function(){var e=this;if(""===this.linkType)return"";var t=this.linkTypes.find(function(t){return t.value===e.linkType});return t.label},handleChangeTemplate:function(e){this.currentTemplate=this.allTemplates.find(function(t){return t.id===e}),this.templateEditBeanList=this.currentTemplate?this.currentTemplate.wechatTemplateEditBeanList:[],this.templateContentList={}},handleEditorChange:function(e,t){var a=this.templateEditBeanList[e].valueParamKey;this.templateContentList[a]=t},handleSendSMS:function(){var e=Object(S["a"])(regeneratorRuntime.mark(function e(){var t,a,n,i,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.validateForm(),e.next=3,this.$request({url:"/component/system/getOpenId",params:{brandCode:this.brandCode,mobileList:this.phoneList.join(",")}});case 3:return t=e.sent,a=t.data,n=a&&a.list?a.list:[],this.wechatOpenIdList=n.map(function(e){return e.openId}),i=this.getData(),e.next=10,this.$request({url:"/component/system/sendTestWechatPublicMessage",method:"POST",params:i});case 10:s=e.sent,this.$emit("onSendSMS",i,s);case 12:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),onaddData:function(e,t){var a=window.getSelection();if(a.focusNode.isContentEditable||a.focusNode.parentNode.isContentEditable){var n=t?6*e.length:18*e.length,i='<input type="text" title="'.concat(e.length,'" style="display:inline;border:none;color:#0a8ddf;width:').concat(n,'px;text-align:center"  class="sms-add-value" value="{').concat(e,'}" readonly/>');if(q(i),!t){var s=this.allParams.find(function(t){return t.paramKey===e}),r=this.paramList.find(function(t){return t.paramKey===e});s&&!r&&this.paramList.push({paramId:s.id,paramKey:s.paramKey,paramValue:s.paramValue})}}else this.$message({message:"请先点击输入框，然后再点击短链进行插入",type:"error"})},validateForm:function(){var e=this;return this.templateId&&""!==this.templateId?0===this.phoneList.length?(this.phoneError=!0,this.phoneTip="请输入手机号，并按下回车键",!1):(this.phoneError=!1,this.phoneList.forEach(function(t){/^1[34578]\d{9}$/.test(t)||(e.phoneError=!0)}),this.phoneError?(this.phoneTip="手机号格式不正确",!1):(this.phoneError=!1,this.phoneTip="",!0)):(this.$message({message:"请选择模板",type:"error"}),!1)},getData:function(){var e=this,t=[];return Object.keys(this.templateContentList).forEach(function(a){t.push({fieldKey:a,fieldValue:e.templateContentList[a]});var n=e.templateEditBeanList.findIndex(function(e){return e.valueParamKey===a});n>-1&&(e.templateEditBeanList[n]=Object(I["a"])({},e.templateEditBeanList[n],{valueParamValue:e.templateContentList[a]}))}),Object(I["a"])({},this.configParams,{wechatTemplateId:this.templateId,fieldList:t,paramList:this.paramList,phoneList:this.phoneList,templateEditBeanList:this.templateEditBeanList,wechatOpenIdList:this.wechatOpenIdList,miniProgramAppId:this.weappId,miniProgramPagePath:this.weappPath,url:this.customLink||this.weappLink,linkType:this.linkType})},setData:function(e){e&&"object"===Object(E["a"])(e)&&(this.templateId=e.wechatTemplateId||"",this.weappId=e.miniProgramAppId||"",this.weappPath=e.miniProgramPagePath||"",this.linkType=e.linkType||"",e.miniProgramAppId?this.weappLink=e.url||"":this.customLink=e.url||"",e.fieldList&&(this.fieldList=e.fieldList),e.paramList&&(this.paramList=e.paramList),e.phoneList&&(this.phoneList=e.phoneList),e.wechatOpenIdList&&(this.wechatOpenIdList=e.wechatOpenIdList),e.templateEditBeanList&&(this.templateEditBeanList=e.templateEditBeanList),e.wechatTemplateId&&this.handleChangeTemplate(e.wechatTemplateId))}}},G=H,Z=(a("8ea4"),a("41ea"),Object(r["a"])(G,C,x,!1,null,"480eb5e4",null)),U=Z.exports;U.install=function(e){e.component(U.name,U)},"undefined"!==typeof window&&window.Vue&&U.install(window.Vue);var z=U;n["default"].use(y["Button"]).use(y["Dialog"]).use(y["Input"]).use(y["Select"]).use(y["Form"]).use(y["FormItem"]).use(y["Option"]).use(y["Table"]).use(y["TableColumn"]).use(y["Pagination"]).use(y["Radio"]),n["default"].use(z),n["default"].use(L.a),n["default"].prototype.$axios=T.a,n["default"].prototype.$request=P,n["default"].config.productionTip=!1,new n["default"]({router:b,store:w,render:function(e){return e(u)}}).$mount("#app")},"5c48":function(e,t,a){},"7c55":function(e,t,a){"use strict";var n=a("5c48"),i=a.n(n);i.a},"8ea4":function(e,t,a){"use strict";var n=a("c4ff"),i=a.n(n);i.a},c4ff:function(e,t,a){},cabc:function(e,t,a){},f5a8:function(e,t,a){"use strict";var n=a("fbf1"),i=a.n(n);i.a},fbf1:function(e,t,a){}});
//# sourceMappingURL=app.4a32be34.js.map